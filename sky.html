<!DOCTYPE html>
<html>

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Sky ü™ê</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
        <link rel="stylesheet" href="https://jenil.github.io/bulmaswatch/darkly/bulmaswatch.min.css">
        <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
        <script src="https://veikkosalminen.github.io/ephemeris-1.2.1.bundle.js"></script>
        <script src="https://veikkosalminen.github.io/radtoaa.js"></script>
        

        <!-- Don't use this in production: -->
        <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    </head>

    <body>
        <div id="root"></div>
        <script type="text/babel">

            const degminsec = (deg) => {
                const d = Math.floor(deg)
                const minfloat = (deg - d) * 60
                const m = Math.floor(minfloat)
                const secfloat = (minfloat - m) * 60
                const s = Math.round(secfloat)
                return `${d}¬∞ ${m}' ${s}"`
            }

            const degmin = (deg) => {
                const d = Math.floor(deg)
                const minfloat = (deg - d) * 60
                const m = Math.floor(minfloat)
                return `${d}¬∞ ${m}'`
            }

            const objectList = [
                { name: "M35", ra: "6:09:00", de: "+24:20:00" },
                { name: "M1", ra: "5:34:00", de: "+22:01:00" },
            ]            

            const hoursminsecToDegrees = ({hours, minutes, seconds}) => {
                return (hours + minutes / 60 + seconds / 3600) * 15
            }

            function Palikka() {
                const [count, setCount] = React.useState(0)

                const test = () => {
                    console.log(Ephemeris)
                    const ephemeris = new Ephemeris.default({
                        key: ["jupiter", "moon", "saturn", "sirius"],
                        year: 2023, month: 2, day: 18, hours: 12, minutes: 12,
                        latitude: 60.812171, longitude: 25.127962,
                        calculateShadows: false
                    })
                    console.log(ephemeris)
                    console.log(degminsec(ephemeris.Observer.latitude), degminsec(ephemeris.Observer.longitude))
                    console.log("jupiter", ephemeris.jupiter.position.altaz.topocentric)
                    console.log("saturn", ephemeris.saturn.position.altaz.topocentric)
                    console.log("moon", ephemeris.moon)
                    
                    const alt = ephemeris.sirius.position.altaz.topocentric.altitude
                    const az = ephemeris.sirius.position.altaz.topocentric.azimuth
                    console.log("sirius", ephemeris.sirius, degminsec(alt), degminsec(az))

                    const obs = {
                        "name": "Helsinki",
                        "year": 2023,
                        "month": 3,
                        "day": 18,
                        "hours": 15,
                        "minutes": 15,
                        "seconds": 12,
                        "tz": -120,
                        "latitude": 60.812171,
                        "longitude": -25.127962,
                    }
                    //"Sirius"
                    const ra = "5:34:30"
                    const de = "+22:01:00"
                    const altaz = RadToAA(ra, de, obs)
                    console.log("own", altaz)
                }

                return (<>
                    <h1 className="title is-1">Hello, world! {count}</h1>
                    <button className="button is-primary" onClick={() => test()}>test</button>
                </>)
            }

            function ShowLocation({altaz}) {
                console.log(altaz)
                let {alt, az} = altaz
               
                return <>üëÜ {degmin(alt)} &nbsp;&nbsp; üß≠ {degmin(az)}</>
               
            }

            function Card({object}) {

                const {name, img, stars, altaz, description } = object

                return <div className="block"><div className="card">
                    <div className="card-image">
                        <figure className="image is-4by4">
                        <img src={img ||¬†"https://bulma.io/images/placeholders/1280x960.png"} alt="Placeholder image" />
                        </figure>
                    </div>
                    <div className="card-content">
                        <div className="media">
                        <div className="media-left">
                            <figure className="image is-48x48">
                            <MapIcon altaz={altaz} />
                            </figure>
                        </div>
                        <div className="media-content">
                            <p className="title is-4">{name}</p>
                            <p className="subtitle is-7">{!!altaz && <ShowLocation altaz={altaz} />}</p>
                        </div>
                        </div>

                        <div className="content">
                        { description }
                        </div>
                        <div className="content">
                            {[...Array(stars).keys()].map(() => "‚≠êÔ∏è")}
                        </div>
                    </div>
                    </div>
                    </div>
            }

            function MapIcon({altaz}) {

                const size = 380

                // convert altitude and azimuth to x and y coordinates
                const {alt, az} = altaz
                const x = 400 + size * Math.sin(az * Math.PI / 180) * Math.cos(alt * Math.PI / 180)
                const y = 400 - size * Math.cos(az * Math.PI / 180) * Math.cos(alt * Math.PI / 180)

                const color = "#0055ab"

                return <svg width="48" height="48" viewBox="0 0 800 800" xmlns="http://www.w3.org/2000/svg">
                    <g>
                        <ellipse cy="400" cx="400" ry="380" rx="380" stroke={color} fill="#061329" strokeWidth="10"/>
                        <ellipse cy="400" cx="400" ry="200" rx="200" stroke={color} fill="none" strokeWidth="7" />
                        
                        <line y2="400" x2="780" y1="400" x1="20" stroke={color} fill="none" strokeWidth="10" />
                        <line y2="120" x2="120" y1="680" x1="680" stroke={color} fill="none" strokeWidth="3" />
                        <line y2="780" x2="400" y1="20" x1="400" stroke={color} fill="none" strokeWidth="10" />
                        <line y2="680" x2="120" y1="120" x1="680" stroke={color} fill="none" strokeWidth="3" />

                        <ellipse cy={y} cx={x} ry="30" rx="30" stroke="yellow" fill="yellow" />
                        
                    </g>
                </svg>
            }

            function SkyList({ date, objects, next, prev }) {
                return <section className="section">
                    <div className="container">
                        <nav className="level is-mobile">
                            <div className="level-left">
                                <h1 className="title">
                                    {date}
                                </h1>
                            </div>
                            <div className="level-right">
                                <div className="buttons has-addons">
                                    <button onClick={() => prev && prev()} className="button">‚óÄÔ∏é</button>
                                    <button onClick={() => next && next()} className="button">‚ñ∂Ô∏é</button>
                                </div>
                            </div>
                        </nav>
                        {objects.map((obj) => <Card key={obj.name} object={obj} />)}
                        </div>
                </section>
            }

            function Main() {

                const obs = {
                    "name": "Helsinki",
                    "year": 2023,
                    "month": 3,
                    "day": 18,
                    "hours": 15,
                    "minutes": 15,
                    "seconds": 12,
                    "tz": -120,
                    "latitude": 60.812171,
                    "longitude": -25.127962,
                }

                const M35 = objectList[1]
                const altaz = RadToAA(M35.ra, M35.de, obs)

                const M1 = objectList[0]
                const altaz2 = RadToAA(M1.ra, M1.de, obs)
                
                const objects = [
                    {name: "M1", img: "https://www.nasa.gov/sites/default/files/styles/full_width/public/thumbnails/image/crab-nebula-mosaic.jpg?itok=DNaRmPtc", stars: 2, altaz: altaz2, description: "Crab nebula. Remnant of a supernova in the year 1054."},
                    {name: "M35", img: "https://www.messier-objects.com/wp-content/uploads/2015/04/Messier-35.jpg", stars: 3, altaz: altaz, description: "Open cluster"},
                    {name: "Jupiter", img: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e2/Jupiter.jpg/600px-Jupiter.jpg", altaz: {alt: 30, az: 270}},
                    {name: "Moon", img: "https://cdn.mos.cms.futurecdn.net/snbrHBRigvvzjxNGuUtcck-970-80.jpg.webp", starts: 3, altaz: altaz},
                ]

                return <SkyList date="Today 18:00" objects={objects} prev={() => console.log("prev")} />
            }

            ReactDOM.render(
                <Main />,
                document.getElementById('root')
            );

        </script>
    </body>

</html>
